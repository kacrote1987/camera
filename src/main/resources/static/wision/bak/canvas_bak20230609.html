<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width">
    <style>
        html,
        body,
        #container {
            width: 100%;
            height: 100%;
        }
    </style>
    <title>圆的绘制和编辑</title>
    <link rel="stylesheet" href="https://a.amap.com/jsapi_demos/static/demo-center/css/demo-center.css"/>
    <script src="https://webapi.amap.com/maps?v=2.0&key=da5c5caa1b78cfce183497a36ad4d2df&plugin=AMap.CircleEditor"></script>
    <script src="https://a.amap.com/jsapi_demos/static/demo-center/js/demoutils.js"></script>
</head>
<body>
<div id="container"></div>
<div class="input-card" style="width: 120px">
    <button class="btn" onclick="circleEditor.open()" style="margin-bottom: 5px">开始编辑</button>
    <button class="btn" onclick="circleEditor.close()">结束编辑</button>
</div>
<script type="text/javascript">
    var map = new AMap.Map('container', {
        resizeEnable: true, //是否监控地图容器尺寸变化
        center: [120.151634, 30.881708],
        zoom: 17, //初始化地图层级
        layers: [new AMap.TileLayer.Satellite()],
        pitch:50, // 地图俯仰角度，有效范围 0 度- 83 度
        viewMode:'2D', // 地图模式
        terrain: true // 开启地形图
    });
    //地图加载完成
    map.on("complete", function () {
        AMap.plugin('AMap.CustomLayer', function () {
            var canvas = document.createElement('canvas');
            customLayer = new AMap.CustomLayer(canvas, {
                zooms: [3, 20],
                alwaysRender: true,//缩放过程中是否重绘，复杂绘制建议设为false
                zIndex: 1000,
                opacity: 0.6,
                collision: false
            });
            // 普通点
            var normalMarker = new AMap.Marker({
                anchor: 'bottom-center',
                offset: [0, -15],
            });
            var markers = [];
            var positions = [[120.151634, 30.881708], [120.152958, 30.882212], [120.151871, 30.88233], [120.151467, 30.882242], [120.152662, 30.882773], [120.152086, 30.882643], [120.151543, 30.882564], [120.152947, 30.882511], [120.152532, 30.883136], [120.151618, 30.882942], [120.152586, 30.883537], [120.151612, 30.883392], [120.152581, 30.884029], [120.152161, 30.884245], [120.151505, 30.883963], [120.152532, 30.88437], [120.151575, 30.884368], [120.15243, 30.884494], [120.151505, 30.884497], [120.152435, 30.88534], [120.152204, 30.885321], [120.152473, 30.884908], [120.152193, 30.884898], [120.151198, 30.882504], [120.151225, 30.882191], [120.152645, 30.882428], [120.15264, 30.882433], [120.152592, 30.882212], [120.152064, 30.881833], [120.152059, 30.881833], [120.151844, 30.882647], [120.151645, 30.882642], [120.151392, 30.882647], [120.152721, 30.882879], [120.152452, 30.882833], [120.15186, 30.883062], [120.151634, 30.883075], [120.151343, 30.883093], [120.152807, 30.88333], [120.152473, 30.883302], [120.152715, 30.883772], [120.152462, 30.883748], [120.151677, 30.883669], [120.151316, 30.883673], [120.152678, 30.884131], [120.152441, 30.884098], [120.151817, 30.884074], [120.151607, 30.88406], [120.151376, 30.884078], [120.152586, 30.884618], [120.152258, 30.884617], [120.151704, 30.884575], [120.151338, 30.884593], [120.152419, 30.885073], [120.152312, 30.885069], [120.152209, 30.885059], [120.152059, 30.885059], [120.151306, 30.881699], [120.152172, 30.882054], [120.152161, 30.882064], [120.151715, 30.88198], [120.151634, 30.88227], [120.152156, 30.882367], [120.152161, 30.882367], [120.152441, 30.882469], [120.151198, 30.882508], [120.152893, 30.883086], [120.152409, 30.882662], [120.152403, 30.882662], [120.152403, 30.882667], [120.15229, 30.88286], [120.152188, 30.88297], [120.152247, 30.883058], [120.15214, 30.883126], [120.151801, 30.883402], [120.152059, 30.883517], [120.152059, 30.883513], [120.152054, 30.883513], [120.152054, 30.883527], [120.152801, 30.883606], [120.152796, 30.883606], [120.152118, 30.883876], [120.151171, 30.883875], [120.151166, 30.883976], [120.152306, 30.884038], [120.152834, 30.88403], [120.152861, 30.884269], [120.152855, 30.884278], [120.152774, 30.884392], [120.152758, 30.884379], [120.151193, 30.884238], [120.151257, 30.884317], [120.152064, 30.884599], [120.15215, 30.884576], [120.15215, 30.884571], [120.15271, 30.884812], [120.152075, 30.884967], [120.152005, 30.885229], [120.152651, 30.885143], [120.152613, 30.885166]];
            var icon = {
                type: 'image',
                image: 'https://webapi.amap.com/theme/v1.3/markers/n/mark_b.png',
                size: [6, 9],
                anchor: 'bottom-center',
            };


            // var onRender = function () {
            //
            // }

            //画布设置
            let size = map.getSize();//resize
            let width = size.width;
            let height = size.height;
            canvas.style.width = width + 'px';
            canvas.style.height = height + 'px';
            canvas.width = width;
            canvas.height = height;//清除画布
            var ctx = canvas.getContext('2d');
            ctx.fillStyle = 'pink';
            ctx.strokeStyle = 'pink';
            ctx.lineWidth = 1;

            for (var i = 0; i < positions.length; i++) {
                var curPosition = positions[i];
                var curData = {
                    position: curPosition,
                    icon:icon,
                };
                var labelMarker = new AMap.LabelMarker(curData);
                markers.push(labelMarker);
                let pos = map.lngLatToContainer(positions[i]);
                ctx.beginPath();
                ctx.moveTo(pos.x, pos.y);
                ctx.arc(pos.x, pos.y, 100, 0, Math.PI * 0.6);
                ctx.lineTo(pos.x, pos.y);
                ctx.closePath();
                ctx.stroke();
                ctx.fill();
                // 给marker绑定事件
                labelMarker.on('mouseover', function (e) {
                    var position = e.data.data && e.data.data.position;
                    if (position) {
                        normalMarker.setContent(
                            '<div class="amap-info-window">'
                            + position +
                            '<div class="amap-info-sharp"></div>' +
                            '</div>');
                        normalMarker.setPosition(position);
                        map.add(normalMarker);
                    }
                });
                labelMarker.on('mouseout', function () {
                    map.remove(normalMarker);
                });
            }

            customLayer.setMap(map);
            customLayer.show();
        });
    });
</script>
</body>
</html>