<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>项目详细</title>
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
  <link rel="stylesheet" href="../../layuiadmin/layui/css/layui.css" media="all">
  <link rel="stylesheet" href="../../layuiadmin/style/admin.css" media="all">
</head>
<body>
<div class="layui-fluid">
  <div class="layui-card">
    <div class="layui-card-body">
      <div class="layui-tab">
        <ul class="layui-tab-title">
          <li class="layui-this">基本情况</li>
          <li>资产管理</li>
          <li>成本管理</li>
          <li>沟通管理</li>
          <li>进度管理</li>
          <li>验收材料</li>
        </ul>
        <div class="layui-tab-content">
          <div class="layui-tab-item layui-show">
            <!--            基本情况页-->
            <div class="layui-row layui-col-space12">
              <div class="layui-col-md2">
              </div>
              <div class="layui-col-md8">
                <div class="layui-card">
                  <input id="action" type="text" name="action" placeholder="" autocomplete="off" class="layui-input" style="display: none">
                  <input id="projId" type="text" name="projId" placeholder="" autocomplete="off" class="layui-input" style="display: none">
                  <div class="layui-card-body">
                    <form class="layui-form" action="" lay-filter="component-form-element">
                      <blockquote class="layui-elem-quote">一、前项收入情况</blockquote>
                      <div class="layui-row layui-col-space10 layui-form-item">
                        <div class="layui-col-lg6">
                          <label class="layui-form-label">项目类型</label>
                          <div class="layui-input-block">
                            <select id="projType" name="projType">
                              <option value="">全部</option>
                              <option value="数改项目">数改项目</option>
                              <option value="市场项目">市场项目</option>
                              <option value="集团项目">集团项目</option>
                              <option value="其他项目">其他项目</option>
                            </select>
                          </div>
                        </div>
                        <div class="layui-col-lg6">
                          <label class="layui-form-label">业务主线</label>
                          <div class="layui-input-block">
                            <select id="projBusin" name="projBusin">
                              <option value="">全部</option>
                              <option value="五统一">五统一</option>
                              <option value="智联网">智联网</option>
                              <option value="智慧交通">智慧交通</option>
                              <option value="智慧园区">智慧园区</option>
                              <option value="智慧医院">智慧医院</option>
                              <option value="智安乡村">智安乡村</option>
                              <option value="智安校园">智安校园</option>
                              <option value="智安小区">智安小区</option>
                              <option value="未来社区">未来社区</option>
                              <option value="其他项目">其他项目</option>
                            </select>
                          </div>
                        </div>
                      </div>
                      <div class="layui-row layui-col-space10 layui-form-item">
                        <div class="layui-col-lg6">
                          <label class="layui-form-label">项目名称</label>
                          <div class="layui-input-block">
                            <input id="projName" type="text" lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                          </div>
                        </div>
                        <div class="layui-col-lg6">
                          <label class="layui-form-label">项目经理</label>
                          <div class="layui-input-block">
                            <input id="projName" type="text" lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                          </div>
                        </div>
                      </div>
                      <div class="layui-row layui-col-space10 layui-form-item">
                        <div class="layui-col-lg6">
                          <label class="layui-form-label">投标情况</label>
                          <div class="layui-input-block">
                            <select id="projBusin" name="projBusin">
                              <option value="">全部</option>
                              <option value="未完成">未完成</option>
                              <option value="已完成">已完成</option>
                            </select>
                          </div>
                        </div>
                        <div class="layui-col-lg6">
                          <label class="layui-form-label">合同签订</label>
                          <div class="layui-input-block">
                            <select id="projBusin" name="projBusin">
                              <option value="">全部</option>
                              <option value="未完成">未完成</option>
                              <option value="已完成">已完成</option>
                            </select>
                          </div>
                        </div>
                      </div>
                      <div class="layui-row layui-col-space10 layui-form-item">
                        <div class="layui-col-lg6">
                          <label class="layui-form-label">项目预算(元)</label>
                          <div class="layui-input-block">
                            <input id="projBudget" type="text" lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                          </div>
                        </div>
                        <div class="layui-col-lg6">
                          <label class="layui-form-label">项目状态</label>
                          <div class="layui-input-block">
                            <select id="projStepcode" name="projStepcode" disabled>
                              <option value="">全部</option>
                              <option value="1">需求阶段</option>
                              <option value="2">方案阶段</option>
                              <option value="3">合同阶段</option>
                              <option value="4">实施阶段</option>
                              <option value="5">初验阶段</option>
                              <option value="6">试运行阶段</option>
                              <option value="7">终验阶段</option>
                              <option value="8">维护阶段</option>
                            </select>
                          </div>
                        </div>
                      </div>
                      <div class="layui-row layui-col-space10 layui-form-item">
                        <div class="layui-col-lg6">
                          <label class="layui-form-label">累计金额</label>
                          <div class="layui-input-block">
                            <input id="projName" type="text" lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                          </div>
                        </div>
                        <div class="layui-col-lg6">
                          <label class="layui-form-label">累计比利</label>
                          <div class="layui-input-block">
                            <input id="projName" type="text" lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                          </div>
                        </div>
                      </div>
                      <div class="layui-row layui-col-space10 layui-form-item">
                        <div class="layui-form-item">
                          <label class="layui-form-label">收入情况</label>
                          <div class="layui-input-block">
                            <textarea id="projComplete" placeholder="" class="layui-textarea"></textarea>
                          </div>
                        </div>
                      </div>
                      <blockquote class="layui-elem-quote">二、后项支出情况</blockquote>
                      <div class="layui-row layui-col-space12">
                        <script type="text/html" id="test-table-toolbar-toolbarDemo1">
                          <div class="layui-btn-container" id="actions">
                            <button class="layui-btn layui-btn-sm" lay-event="add">新增</button>
                            <button class="layui-btn layui-btn-sm" lay-event="del">删除</button>
                          </div>
                        </script>
                        <div class="layui-col-md12">
                          <div class="layui-card">
                            <div class="layui-card-body">
                              <table id="test-table-gantt1" lay-filter="test-table-gantt1"></table>
                            </div>
                          </div>
                        </div>
                        <div class="layui-col-md1">
                        </div>
                      </div>

                    </form>
                  </div>
                </div>
              </div>
              <div class="layui-col-md2">
              </div>
            </div>
          </div>
          <div class="layui-tab-item">
            <!--            资产管理-->
            <div class="layui-card-body">
              <table id="test-table-toolbar-assProj" lay-filter="test-table-toolbar-assProj"></table>
              <script type="text/html" id="imgTpl">
                <img style="display: inline-block; width: 50%; height: 100%;" src= {{ d.avatar }}>
              </script>
            </div>
          </div>
          <div class="layui-tab-item">
            <!--            成本管理-->
            <div class="layui-row layui-col-space12">
              <div class="layui-col-md2">
              </div>
              <div class="layui-col-md8">
                <div class="layui-card">
                  <div class="layui-card-body">
                    <form class="layui-form" action="" lay-filter="component-form-element">
                      <blockquote class="layui-elem-quote">一、前项信息</blockquote>
                      <div class="layui-row layui-col-space10 layui-form-item">
                        <div class="layui-col-lg12">
                          <label class="layui-form-label">项目名称</label>
                          <div class="layui-input-block">
                            <input id="projName" type="text" lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                          </div>
                        </div>
                      </div>
                      <div class="layui-row layui-col-space10 layui-form-item">
                        <div class="layui-col-lg6">
                          <label class="layui-form-label">项目预算(元)</label>
                          <div class="layui-input-block">
                            <input id="projBudget" type="text" lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                          </div>
                        </div>
                      </div>
                      <div class="layui-row layui-col-space10 layui-form-item">
                        <div class="layui-col-lg6">
                          <label class="layui-form-label">合同日期</label>
                          <div class="layui-input-block">
                            <input id="projContracttime" type="text" lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                          </div>
                        </div>
                        <div class="layui-col-lg6">
                          <label class="layui-form-label">项目工期</label>
                          <div class="layui-input-block">
                            <input id="projDeadline" type="text" lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                          </div>
                        </div>
                      </div>
                      <div class="layui-row layui-col-space10 layui-form-item">
                        <div class="layui-col-lg6">
                          <label class="layui-form-label">项目变更</label>
                          <div class="layui-input-block">
                            <select id="projChange">
                              <option value="">请选择</option>
                              <option value="是">是</option>
                              <option value="否">否</option>
                            </select>
                          </div>
                        </div>
                        <div class="layui-col-lg6">
                          <label class="layui-form-label">项目延期(天)</label>
                          <div class="layui-input-block">
                            <input id="projDelay" type="text" lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                          </div>
                        </div>
                      </div>
                      <blockquote class="layui-elem-quote">二、后项信息</blockquote>
                      <div class="layui-row layui-col-space10 layui-form-item">
                        <div class="layui-col-lg6">
                          <label class="layui-form-label">项目经理</label>
                          <div class="layui-input-block">
                            <input id="projManager" type="text" lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                          </div>
                        </div>
                        <div class="layui-col-lg6">
                          <label class="layui-form-label">市场负责人</label>
                          <div class="layui-input-block">
                            <input id="projMarketman" type="text" lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                          </div>
                        </div>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
              <div class="layui-col-md2">
              </div>
            </div>
          </div>
          <div class="layui-tab-item">
            <!--            沟通管理-->
            <div class="layui-row layui-col-space15">
              <div class="layui-col-md12">
                <div class="layui-card">
                  <div class="layui-card-body">
                    <ul class="layui-timeline">
                      <li class="layui-timeline-item">
                        <i class="layui-icon layui-timeline-axis"></i>
                        <div class="layui-timeline-content layui-text">
                          <h3 class="layui-timeline-title">2022年1月1日例会纪要</h3>
                          <ul>
                            <li>xxxxxxxxxxxxxxx</li>
                          </ul>
                        </div>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="layui-tab-item">
            <!--            进度管理：甘特图配置-->
            <div class="layui-row layui-col-space12">
              <script type="text/html" id="test-table-toolbar-toolbarDemo">
                <div class="layui-btn-container" id="actions">
                  <button class="layui-btn layui-btn-sm" lay-event="add">新增</button>
                  <button class="layui-btn layui-btn-sm" lay-event="del">删除</button>
                </div>
              </script>
              <div class="layui-col-md10">
                <div class="layui-card">
                  <div class="layui-card-body">
                    <table id="test-table-gantt" lay-filter="test-table-gantt"></table>
                  </div>
                </div>
              </div>
              <div class="layui-col-md1">
              </div>
            </div>
          </div>
          <div class="layui-tab-item">
            <!--            验收材料-->
            <div class="layui-row layui-col-space12">
              <div class="layui-col-md2">
              </div>
              <div class="layui-col-md8">
                <div class="layui-card">
                  <div class="layui-card-body">
                    <form class="layui-form" action="" lay-filter="component-form-element">
                      <div class="layui-row layui-col-space10 layui-form-item">
                        <div class="layui-col-lg6">
                          <label class="layui-form-label">招标文件</label>
                          <div class="layui-input-block">
                            <input id="" type="text" lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                          </div>
                        </div>
                        <div class="layui-col-lg6">
                          <label class="layui-form-label">投标文件</label>
                          <div class="layui-input-block">
                            <input id="" type="text" lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                          </div>
                        </div>
                      </div>
                      <div class="layui-row layui-col-space10 layui-form-item">
                        <div class="layui-col-lg6">
                          <label class="layui-form-label">合同文件</label>
                          <div class="layui-input-block">
                            <input id="" type="text" lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                          </div>
                        </div>
                        <div class="layui-col-lg6">
                          <label class="layui-form-label">合同日期</label>
                          <div class="layui-input-block">
                            <input id="" type="text" lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                          </div>
                        </div>
                      </div>
                      <div class="layui-row layui-col-space10 layui-form-item">
                        <div class="layui-col-lg6">
                          <label class="layui-form-label">初验材料</label>
                          <div class="layui-input-block">
                            <input id="" type="text" lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                          </div>
                        </div>
                        <div class="layui-col-lg6">
                          <label class="layui-form-label">初验日期</label>
                          <div class="layui-input-block">
                            <input id="" type="text" lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                          </div>
                        </div>
                      </div>
                      <div class="layui-row layui-col-space10 layui-form-item">
                        <div class="layui-col-lg6">
                          <label class="layui-form-label">变更材料</label>
                          <div class="layui-input-block">
                            <input id="" type="text" lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                          </div>
                        </div>
                        <div class="layui-col-lg6">
                          <label class="layui-form-label">变更日期</label>
                          <div class="layui-input-block">
                            <input id="" type="text" lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                          </div>
                        </div>
                      </div>
                      <div class="layui-row layui-col-space10 layui-form-item">
                        <div class="layui-col-lg6">
                          <label class="layui-form-label">终验材料</label>
                          <div class="layui-input-block">
                            <input id="" type="text" lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                          </div>
                        </div>
                        <div class="layui-col-lg6">
                          <label class="layui-form-label">终验日期</label>
                          <div class="layui-input-block">
                            <input id="" type="text" lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                          </div>
                        </div>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
              <div class="layui-col-md2">
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="layui-form-item layui-layout-admin">
  <div class="layui-input-block">
    <div class="layui-footer" style="left: 0;">
      <button id="scienSave" class="layui-btn" lay-submit="submit" lay-filter="component-form-demo1" onclick="save()">保存</button>
    </div>
  </div>
</div>

<script src="http://apps.bdimg.com/libs/jquery/2.0.0/jquery.min.js"></script>
<script src="http://apps.bdimg.com/libs/bootstrap/3.3.0/js/bootstrap.min.js"></script>
<script src="${pageContext.request.contextPath}/resources/script/login.js"></script>
<script src="../js/demo.js"></script>
<script src="../../layuiadmin/layui/layui.js"></script>
<script>
  layui.config({
    base: '../../layuiadmin/' //静态资源所在路径
  }).extend({
    index: 'lib/index' //主入口模块
  }).use(['index', 'form', 'table','laydate'], function(){
    var $ = layui.$
            ,form = layui.form
            ,laydate = layui.laydate
            ,table = layui.table;

    form.render(null, 'component-form-group');
    var projId=window.location.search.substring(1,window.location.search.length);
    if(projId=="add"){
      $('#action').val("add");
      document.getElementById("actions").style.display='none';
    }else{
      $('#action').val("update");
      $('#projId').val(projId);
    }
    $.ajax({
      type:"post",
      url:"/proj/projdet",
      contentType:"application/json;charset=utf-8",
      dataType:"json",
      data:projId,
      success:function(detObj){
        if(detObj.msg=="sucess"){
          var detJson=detObj.data[0];
          $('#projId').val(detJson.projId);
          $('#projType').val(detJson.projType);
          $('#projBusin').val(detJson.projBusin);
          $('#projName').val(detJson.projName);
          $('#contractTime').val(detJson.contractTime);
          $('#projBudget').val(detJson.projBudget);
          $('#projDeadline').val(detJson.projDeadline);
          $('#projManager').val(detJson.projManager);
          $('#projMarketman').val(detJson.projMarketman);
          $('#userUnit').val(detJson.userUnit);
          $('#userMan').val(detJson.userMan);
          $('#supervisionUnit').val(detJson.supervisionUnit);
          $('#supervisionMan').val(detJson.supervisionMan);
          $('#contractUnit').val(detJson.contractUnit);
          $('#contractMan').val(detJson.contractMan);
          $('#projCost').val(detJson.projCost);
          $('#budgetComplete').val(detJson.budgetComplete);
          $('#budgetAmount').val(detJson.budgetAmount);
          $('#budgetPercent').val(detJson.budgetPercent);
          $('#projChange').val(detJson.projChange);
          $('#projDelay').val(detJson.projDelay);
          $('#projComplete').val(detJson.projComplete);
          $('#projProblem').val(detJson.projProblem);
          $('#projStepcode').val(detJson.projStepcode);
          layui.form.render();
        }
      }
    });

    // 资产管理
    table.render({
      elem: '#test-table-toolbar-assProj'
      ,id: 'assReload'
      ,method: 'post'
      ,url: '/proj/assproj?' +projId
      ,response:{
        statusName:'code',
        statusCode:'200',
        msgName:'msg',
        dataName:'data'
      }
      ,toolbar: '#test-table-toolbar-assProj-toolbarDemo'
      ,title: '项目资产信息表'
      ,cols: [[
        {type: 'checkbox', fixed: 'left', width:'5%'}
        ,{field: 'assId', title: '序号', width:'5%'}
        ,{field: 'assType', title: '资产类别',sort: true, width:'10%'}
        ,{field: 'assName', title: '资产名称',sort: true, width:'20%'}
        ,{field: 'assModel', title: '资产型号',sort: true, width:'20%'}
        ,{field: 'factoryNo', title: '出厂编号',sort: true, width:'20%'}
        ,{field: 'brandName', title: '厂商名称',sort: true, width:'10%'}
        ,{field: 'assState', title: '设备状态',sort: true, width:'10%'}
      ]]
    });

    //成本管理
    table.render({
      elem: '#test-table-cost'
      , id: 'costReload'
      , method: 'post'
      , url: '/proj/projcost?' + projId
      ,response:{
        statusName:'code',
        statusCode:'200',
        msgName:'msg',
        dataName:'data'
      }
      , toolbar: '#test-table-toolbar-cost'
      , title: '成本管理'
      , cols: [[
        {type: 'checkbox', fixed: 'left', width: '5%'}
        , {field: 'assId', title: '序号', width: '5%'}
        , {field: 'assType', title: '资产类别', width: '13%'}
        , {field: 'brandName', title: '供应商', width: '13%'}
        , {field: 'assNum', title: '资产数量', width: '13%'}
        , {field: 'assPrice', title: '厂商单价', edit: 'text', width: '13%'}
        , {field: 'assTotal', title: '厂商总价', width: '13%'}
        , {field: '', title: '利润值', width: '13%'}
        , {field: '', title: '利润率', width: '12%'}
      ]]
    });

    //监听单元格编辑
    table.on('edit(test-table-cost)', function (obj) {
      var params = {};
      params.action = "update";
      params.ganttId = obj.data.ganttId;
      params.field = obj.field;
      params.value = obj.value;
      postdata(params, "/proj/ganttdo", function () {table.reload('costReload');layer.msg("更新成功");})
    });

    //支出项目
    table.render({
      elem: '#test-table-gantt1'
      , id: 'ganttReload1'
      , method: 'post'
      , url: '/proj/conseqlist?' + projId
      , toolbar: '#test-table-toolbar-toolbarDemo1'
      , title: '后项项目列表'
      , page: false
      , cols: [[
        {type: 'checkbox', fixed: 'left', width: '50'}
        , {field: 'conseqId', title: '序号', width: '80'}
        , {field: 'conseqName', title: '支出项目名称', edit: 'text', width: '214'}
        , {field: 'purchaseState', title: '采购流程', edit: 'text', width: '214'}
        , {field: 'bidState', title: '投标情况', edit: 'text', width: '150'}
        , {field: 'contractState', title: '合同情况', width: '150'}
        , {fixed: 'right', title: '操作', toolbar: '#test-table-toolbar-barDemo', width: '10%'}
      ]]
      ,done: function (res, curr, count) {
        $(".layui-table-body, .layui-table-box, .layui-table-cell").css('overflow', 'visible');
      }
    });

    //进度管理
    table.render({
      elem: '#test-table-gantt'
      , id: 'ganttReload'
      , method: 'post'
      , url: '/proj/ganttdet?' + projId
      , toolbar: '#test-table-toolbar-toolbarDemo'
      , title: '甘特图配置'
      , page: false
      , cols: [[
        {type: 'checkbox', fixed: 'left', width: '50'}
        , {field: 'ganttId', title: '序号', width: '80'}
        , {field: 'ganttType', title: '类别', edit: 'text', width: '214'}
        , {field: 'ganttProce', title: '工序', edit: 'text', width: '214'}
        , {field: 'ganttTime1', title: '开始时间', edit: 'text', width: '150'}
        , {field: 'ganttTime2', title: '结束时间', edit: 'text', width: '150'}
        , {field: 'total', title: '目标总数', edit: 'text', width: '150'}
        , {field: 'sum', title: '已完成', width: '150'}
      ]]
      ,done: function (res, curr, count) {
        $(".layui-table-body, .layui-table-box, .layui-table-cell").css('overflow', 'visible');
      }
    });

    //头工具栏事件
    table.on('toolbar(test-table-gantt)', function (obj) {
      var checkStatus = table.checkStatus(obj.config.id);
      var params = {};
      params.projId = document.getElementById("projId").value;
      switch (obj.event) {
        case 'add':
          params.action="add";
          postdata(params,"/proj/ganttdo",function () {table.reload('ganttReload');layer.msg("添加成功！");});
          break;
        case 'del':
          params.action="del";
          params.ganttId=checkStatus.data[0].ganttId;
          postdata(params,"/proj/ganttdo",function () {table.reload('ganttReload');layer.msg("已删除！");});
          break;
      };
    });

    //监听单元格编辑
    table.on('edit(test-table-gantt)', function (obj) {
      var params = {};
      params.action = "update";
      params.ganttId = obj.data.ganttId;
      params.field = obj.field;
      params.value = obj.value;
      postdata(params, "/proj/ganttdo", function () {table.reload('ganttReload');layer.msg("更新成功");})
    });

    laydate.render({
      elem: '#projApptime'
    });

    /* 自定义验证规则 */
    form.verify({
      scienNo: function(value){
        if(value.length < 10){
          return '标题至少得10个字符啊';
        }
      }
    });

  });

  function save(){
    var params={};
    params.action=$('#action').val();
    params.projId=$('#projId').val();
    params.projType=$('#projType').val();
    params.projBusin=$('#projBusin').val();
    params.projName=$('#projName').val();
    params.contractTime=$('#contractTime').val();
    params.projBudget=$('#projBudget').val();
    params.projDeadline=$('#projDeadline').val();
    params.projManager=$('#projManager').val();
    params.projMarketman=$('#projMarketman').val();
    params.userUnit=$('#userUnit').val();
    params.userMan=$('#userMan').val();
    params.supervisionUnit=$('#supervisionUnit').val();
    params.supervisionMan=$('#supervisionMan').val();
    params.contractUnit=$('#contractUnit').val();
    params.contractMan=$('#contractMan').val();
    params.projCost=$('#projCost').val();
    params.budgetComplete=$('#budgetComplete').val();
    params.budgetAmount=$('#budgetAmount').val();
    params.budgetPercent=$('#budgetPercent').val();
    params.projChange=$('#projChange').val();
    params.projDelay=$('#projDelay').val();
    params.projComplete=$('#projComplete').val();
    params.projProblem=$('#projProblem').val();
    params.projStepcode=$('#projStepcode').val();
    postdata(params,"/proj/projsave",function () {layer.msg("保存成功！");});
  }
</script>
</body>
</html>