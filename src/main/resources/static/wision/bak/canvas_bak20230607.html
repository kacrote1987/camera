<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width">
    <style>
        html,
        body,
        #container {
            width: 100%;
            height: 100%;
        }
        .box {
            width: 600px;
            height: 600px;
            margin: 0 auto;
        }
    </style>
    <title>万像慧治</title>
    <link rel="stylesheet" href="https://a.amap.com/jsapi_demos/static/demo-center/css/demo-center.css"/>
    <script src="https://webapi.amap.com/maps?v=2.0&key=da5c5caa1b78cfce183497a36ad4d2df&plugin=AMap.CircleEditor"></script>
    <script src="https://a.amap.com/jsapi_demos/static/demo-center/js/demoutils.js"></script>
    <link rel="shortcut icon" type="image/x-icon" href="../img/logo.png" />
</head>
<body>
<div id="container" class="box">
    <canvas id="mycan" class="mycan"></canvas>
</div>
<script src="http://apps.bdimg.com/libs/jquery/2.0.0/jquery.min.js"></script>
<script src="http://apps.bdimg.com/libs/bootstrap/3.3.0/js/bootstrap.min.js"></script>
<script src="${pageContext.request.contextPath}/resources/script/login.js"></script>
<script src="../js/demo.js"></script>
<script src="../../layuiadmin/layui/layui.js"></script>
<script type="text/javascript">
    layui.config({
        base: '../../layuiadmin/' //静态资源所在路径
    }).extend({
        index: 'lib/index' //主入口模块
    }).use(['index', 'form', 'table', 'laydate'], function() {
        var $ = layui.$
            ,form = layui.form
        form.render(null, 'component-form-group');
    });
    // $.ajax({
    //     type: "post",
    //     url: "/camera/lnglatdet",
    //     contentType: "application/json;charset=utf-8",
    //     dataType: "json",
    //     success: function (detObj) {
    //         if (detObj.msg == "sucess") {
    //             var detJson = detObj.data[0].lngLat;
    //             $('#lngLat').val(detJson);
    //             alert($('#lngLat').val());
    //             layui.form.render();
    //         }
    //     }
    // });
    // alert($('#lngLat').val());
    var detJson2=[[120.151634,30.881708],[120.152958,30.882212],[120.151871,30.88233],[120.151467,30.882242],[120.152662,30.882773],[120.152086,30.882643],[120.151543,30.882564],[120.152947,30.882511],[120.152532,30.883136],[120.151618,30.882942]];

    var map = new AMap.Map('container', {
        resizeEnable: true, //是否监控地图容器尺寸变化
        center: [120.151634, 30.881708],
        zoom: 17, //初始化地图层级
    });
    //地图加载完成
    map.on("complete", function () {
        AMap.plugin('AMap.CustomLayer', function () {
            var canvas = document.getElementById('mycan');
            customLayer = new AMap.LabelsLayer(canvas, {
                zooms: [3, 20],
                alwaysRender: false,//缩放过程中是否重绘，复杂绘制建议设为false
                zIndex: 1000,
                opacity: 0.6,
                collision: false
            });
            // 普通点
            var normalMarker = new AMap.Marker({
                anchor: 'bottom-center',
                offset: [0, -15],
            });
            var markers = [];
            var positions = detJson2;
            var icon = {
                type: 'image',
                image: 'https://webapi.amap.com/theme/v1.3/markers/n/mark_b.png',
                size: [16, 19],
                anchor: 'bottom-center',
            };

            //画布设置
            let size = map.getSize();//resize
            let width = size.width;
            let height = size.height;
            canvas.style.width = width + 'px';
            canvas.style.height = height + 'px';
            canvas.width = width;
            canvas.height = height;//清除画布
            var ctx = canvas.getContext('2d');
            ctx.fillStyle = 'lightgreen';
            // ctx.strokeStyle = 'red';
            ctx.lineWidth = 4;
            for (var i = 0; i < positions.length; i++) {
                var curPosition = positions[i];
                var curData = {
                    position: curPosition,
                    icon:icon,
                };
                var labelMarker = new AMap.LabelMarker(curData);
                markers.push(labelMarker);
                let pos = map.lngLatToContainer(positions[i]);
                ctx.beginPath();
                ctx.moveTo(pos.x, pos.y);
                ctx.arc(pos.x, pos.y, 100, 0, Math.PI * 0.6);
                ctx.lineTo(pos.x, pos.y);
                ctx.closePath();
                // ctx.stroke();
                ctx.fill();
                // 给marker绑定事件
                labelMarker.on('mouseover', function (e) {
                    var position = e.data.data && e.data.data.position;
                    if (position) {
                        normalMarker.setContent(
                            '<div class="amap-info-window">'
                            + position +
                            '<div class="amap-info-sharp"></div>' +
                            '</div>');
                        normalMarker.setPosition(position);
                        map.add(normalMarker);
                    }
                });
                labelMarker.on('mouseout', function () {
                    map.remove(normalMarker);
                });
            }
            customLayer.add(markers);
            customLayer.setMap(map);
            customLayer.show(map);
        });
    });
</script>
</body>
</html>