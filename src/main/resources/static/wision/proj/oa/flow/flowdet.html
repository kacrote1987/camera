<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>流程详细</title>
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
  <link rel="stylesheet" href="../../../layuiadmin/layui/css/layui.css" media="all">
  <link rel="stylesheet" href="../../../layuiadmin/style/admin.css" media="all">
</head>
<body>
<div class="layui-fluid">
  <div class="layui-card">
    <div class="layui-card-body">
      <div class="layui-row layui-col-space12">
        <div class="layui-col-md2">
        </div>
        <div class="layui-col-md8">
          <div class="layui-card">
            <div class="layui-card-header">项目基本情况</div>
            <input id="scienId" type="text" name="fullname" placeholder="" autocomplete="off" class="layui-input" style="display: none">
            <div class="layui-card-body">
              <form class="layui-form" action="" lay-filter="component-form-element">
                <div class="layui-row layui-col-space10 layui-form-item">
                  <div class="layui-col-lg6">
                    <label class="layui-form-label">项目类别*</label>
                    <div class="layui-input-block">
                      <select id="scienType" name="scienType" lay-verify="required" lay-filter="aihao">
                        <option value=""></option>
                        <option value="科研项目">科研项目</option>
                        <option value="技术保障项目">技术保障项目</option>
                      </select>
                    </div>
                  </div>
                  <div class="layui-col-lg6">
                    <label class="layui-form-label">申报日期</label>
                    <div class="layui-input-block">
                      <input id="scienApptime" type="text" name="fullname" lay-verify="required" placeholder="" autocomplete="off" class="layui-input" readonly>
                    </div>
                  </div>
                </div>
                <div class="layui-row layui-col-space10 layui-form-item">
                  <div class="layui-col-lg6">
                    <label class="layui-form-label">项目申报编号*</label>
                    <div class="layui-input-block">
                      <input id="scienNo" type="text" name="fullname" lay-verify="scienNo" placeholder="" autocomplete="off" class="layui-input">
                    </div>
                  </div>
                  <div class="layui-col-lg6">
                    <label class="layui-form-label">项目年度*</label>
                    <div class="layui-input-block">
                      <input id="scienYear" type="text" name="fullname" lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                    </div>
                  </div>
                </div>
                <div class="layui-row layui-col-space10 layui-form-item">
                  <div class="layui-col-lg6">
                    <label class="layui-form-label">项目名称*</label>
                    <div class="layui-input-block">
                      <input id="scienName" type="text" name="fullname" lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                    </div>
                  </div>
                  <div class="layui-col-lg6">
                    <label class="layui-form-label">专业类别*</label>
                    <div class="layui-input-block">
                      <select id="scienMajor" name="scienMajor" lay-verify="required" lay-filter="aihao">
                        <option value=""></option>
                        <option value="锅炉">锅炉</option>
                        <option value="容器">容器</option>
                        <option value="电梯">电梯</option>
                        <option value="起重">起重</option>
                        <option value="厂车">厂车</option>
                      </select>
                    </div>
                  </div>
                </div>
                <div class="layui-card-header">项目基本情况</div>
                <div class="layui-row layui-col-space10 layui-form-item">
                  <div class="layui-col-lg6">
                    <label class="layui-form-label">单位名称*</label>
                    <div class="layui-input-block">
                      <input id="unitName" type="text" name="fullname" lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                    </div>
                  </div>
                  <div class="layui-col-lg6">
                    <label class="layui-form-label">统一社会信用代码*</label>
                    <div class="layui-input-block">
                      <input id="unitCode" type="text" name="fullname" lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                    </div>
                  </div>
                </div>
                <div class="layui-row layui-col-space10 layui-form-item">
                  <div class="layui-col-lg6">
                    <label class="layui-form-label">联系人*</label>
                    <div class="layui-input-block">
                      <input id="unitContman" type="text" name="fullname" lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                    </div>
                  </div>
                  <div class="layui-col-lg6">
                    <label class="layui-form-label">联系电话*</label>
                    <div class="layui-input-block">
                      <input id="unitConttel" type="text" name="fullname" lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                    </div>
                  </div>
                </div>
                <div class="layui-row layui-col-space10 layui-form-item">
                  <div class="layui-col-lg6">
                    <label class="layui-form-label">通讯地址*</label>
                    <div class="layui-input-block">
                      <input id="unitAddr" type="text" name="fullname" lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                    </div>
                  </div>
                  <div class="layui-col-lg6">
                    <label class="layui-form-label">邮政编码*</label>
                    <div class="layui-input-block">
                      <input id="unitPost" type="text" name="fullname" lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                    </div>
                  </div>
                </div>
                <div class="layui-form-item">
                  <label class="layui-form-label">单位性质*</label>
                  <div class="layui-input-block">
                    <input type="radio" name="unitNature" value="事业型研究单位" title="事业型研究单位">
                    <input type="radio" name="unitNature" value="大专院校" title="大专院校">
                    <input type="radio" name="unitNature" value="其他事业单位" title="其他事业单位">
                    <input type="radio" name="unitNature" value="社会团体" title="社会团体">
                    <input type="radio" name="unitNature" value="企业" title="企业">
                    <input type="radio" name="unitNature" value="其他" title="其他">
                  </div>
                </div>
                <div class="layui-card-header">项目主要参加单位</div>
                <div class="layui-row layui-col-space10 layui-form-item">
                  <div class="layui-col-lg6">
                    <label class="layui-form-label">单位名称*</label>
                    <div class="layui-input-block">
                      <input id="unitCoop" type="text" name="fullname" lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                    </div>
                  </div>
                </div>
                <div class="layui-card-header">项目负责人</div>
                <div class="layui-row layui-col-space10 layui-form-item">
                  <div class="layui-col-lg6">
                    <label class="layui-form-label">姓名*</label>
                    <div class="layui-input-block">
                      <input type="text" id="scienAppman" lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                    </div>
                  </div>
                  <div class="layui-col-lg6">
                    <label class="layui-form-label">性别*</label>
                    <div class="layui-input-block">
                      <input type="radio" name="scienAppsex" value="男" title="男">
                      <input type="radio" name="scienAppsex" value="女" title="女">
                    </div>
                  </div>
                </div>
                <div class="layui-row layui-col-space10 layui-form-item">
                  <div class="layui-col-lg6">
                    <label class="layui-form-label">学位*</label>
                    <div class="layui-input-block">
                      <input type="radio" name="scienAppdegree" value="博士" title="博士">
                      <input type="radio" name="scienAppdegree" value="硕士" title="硕士">
                      <input type="radio" name="scienAppdegree" value="学士" title="学士">
                      <input type="radio" name="scienAppdegree" value="其他" title="其他">
                    </div>
                  </div>
                  <div class="layui-col-lg6">
                    <label class="layui-form-label">出生日期*</label>
                    <div class="layui-input-block">
                      <input type="text" id="scienAppbirth" lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                    </div>
                  </div>
                </div>
                <div class="layui-row layui-col-space10 layui-form-item">
                  <div class="layui-col-lg6">
                    <label class="layui-form-label">职称*</label>
                    <div class="layui-input-block">
                      <input type="radio" name="scienAppprof" value="高级" title="高级">
                      <input type="radio" name="scienAppprof" value="中级" title="中级">
                      <input type="radio" name="scienAppprof" value="初级" title="初级">
                      <input type="radio" name="scienAppprof" value="其他" title="其他">
                    </div>
                  </div>
                  <div class="layui-col-lg6">
                    <label class="layui-form-label">专业*</label>
                    <div class="layui-input-block">
                      <input id="scienAppmajor" type="text" lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                    </div>
                  </div>
                </div>
                <div class="layui-row layui-col-space10 layui-form-item">
                  <div class="layui-col-lg6">
                    <label class="layui-form-label">办公电话*</label>
                    <div class="layui-input-block">
                      <input type="text" id="scienApptel" lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                    </div>
                  </div>
                  <div class="layui-col-lg6">
                    <label class="layui-form-label">移动电话*</label>
                    <div class="layui-input-block">
                      <input type="text" id="scienAppphone" lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                    </div>
                  </div>
                </div>
                <div class="layui-row layui-col-space10 layui-form-item">
                  <div class="layui-col-lg6">
                    <label class="layui-form-label">E-mail*</label>
                    <div class="layui-input-block">
                      <input type="text" id="scienAppemail" lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                    </div>
                  </div>
                </div>
                <div class="layui-row layui-col-space10 layui-form-item">
                  <div class="layui-col-lg6">
                    <label class="layui-form-label">项目团队</label>
                    <div class="layui-input-block">
                      <input type="text" id="scienAppteam" lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                    </div>
                  </div>
                </div>
                <div class="layui-row layui-col-space10 layui-form-item">
                  <div class="layui-col-lg6">
                    <label class="layui-form-label">起止时间</label>
                    <div class="layui-input-block">
                      <input type="text" id="scienApplife" lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                    </div>
                  </div>
                </div>
                <div class="layui-form-item">
                  <label class="layui-form-label">创新类型</label>
                  <div class="layui-input-block">
                    <input type="checkbox" name="scienInnov" value="原始创新" title="原始创新" lay-skin="primary">
                    <input type="checkbox" name="scienInnov" value="集成创新" title="集成创新" lay-skin="primary">
                    <input type="checkbox" name="scienInnov" value="引进消化吸收再创新" title="引进消化吸收再创新" lay-skin="primary">
                  </div>
                </div>
                <div class="layui-form-item">
                  <label class="layui-form-label">研究内容摘要</label>
                  <div class="layui-input-block">
                    <textarea id="scienNote" placeholder="" class="layui-textarea"></textarea>
                  </div>
                </div>
                <div class="layui-form-item">
                  <label class="layui-form-label">预期成果</label>
                  <div class="layui-input-block">
                    <textarea id="scienAchiev" placeholder="" class="layui-textarea"></textarea>
                  </div>
                </div>
                <div class="layui-row layui-col-space10 layui-form-item">
                  <div class="layui-col-lg6">
                    <label class="layui-form-label">经费预算(元)</label>
                    <div class="layui-input-block">
                      <input type="text" id="scienCost" lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                    </div>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
        <div class="layui-col-md2">
        </div>
      </div>
    </div>
  </div>
</div>
<div class="layui-form-item layui-layout-admin">
  <div class="layui-input-block">
    <div class="layui-footer" style="left: 0;">
      <button id="scienSave" class="layui-btn" lay-submit="submit" lay-filter="component-form-demo1" onclick="save()">保存</button>
      <input id="scienStepcode" type="text" name="fullname" lay-verify="required" placeholder="" autocomplete="off" class="layui-input" style="display: none">
    </div>
  </div>
</div>

<script src="http://apps.bdimg.com/libs/jquery/2.0.0/jquery.min.js"></script>
<script src="http://apps.bdimg.com/libs/bootstrap/3.3.0/js/bootstrap.min.js"></script>
<script src="${pageContext.request.contextPath}/resources/script/login.js"></script>
<script src="../../js/demo.js"></script>
<script src="../../../layuiadmin/layui/layui.js"></script>
<script>
  layui.config({
    base: '../../../layuiadmin/' //静态资源所在路径
  }).extend({
    index: 'lib/index' //主入口模块
  }).use(['index', 'form', 'table'], function(){
    var $ = layui.$
            ,admin = layui.admin
            ,element = layui.element
            ,form = layui.form
            ,table = layui.table;

    form.render(null, 'component-form-group');

    var scienId=window.location.search.substring(1,window.location.search.length);
    $.ajax({
      type:"post",
      url:"/scien/sciendet",
      contentType:"application/json;charset=utf-8",
      dataType:"json",
      data:scienId,
      success:function(detObj){
        if(detObj.msg=="sucess"){
          var detJson=detObj.data[0];
          $('#scienId').val(detJson.scienId);
          $('#scienType').val(detJson.scienType);
          $('#scienNo').val(detJson.scienNo);
          $('#scienYear').val(detJson.scienYear);
          $('#scienName').val(detJson.scienName);
          $('#scienMajor').val(detJson.scienMajor);
          $('#unitName').val(detJson.unitName);
          $('#unitCode').val(detJson.unitCode);
          $('#unitContman').val(detJson.unitContman);
          $('#unitConttel').val(detJson.unitConttel);
          $('#unitAddr').val(detJson.unitAddr);
          $('#unitPost').val(detJson.unitPost);
          $("input[name=unitNature][value="+detJson.unitNature+"]").prop("checked","false");
          $('#unitCoop').val(detJson.unitCoop);
          $('#scienAppman').val(detJson.scienAppman);
          $("input[name=scienAppsex][value="+detJson.scienAppsex+"]").prop("checked","false");
          $("input[name=scienAppdegree][value="+detJson.scienAppdegree+"]").prop("checked","false");
          $('#scienAppbirth').val(detJson.scienAppbirth);
          $("input[name=scienAppprof][value="+detJson.scienAppprof+"]").prop("checked","false");
          $('#scienAppmajor').val(detJson.scienAppmajor);
          $('#scienApptel').val(detJson.scienApptel);
          $('#scienAppphone').val(detJson.scienAppphone);
          $('#scienAppemail').val(detJson.scienAppemail);
          $('#scienAppteam').val(detJson.scienAppteam);
          $('#scienApplife').val(detJson.scienApplife);
          var split = detJson.scienInnov.split(",");
          for (var i = 0; i < split.length; i++) {
            $("input[name=scienInnov][value="+split[i]+"]").attr("checked",true);
          }
          $('#scienNote').val(detJson.scienNote);
          $('#scienAchiev').val(detJson.scienAchiev);
          $('#scienCost').val(detJson.scienCost);
          $('#scienAnnex').val(detJson.scienAnnex);
          $('#scienApptime').val(detJson.scienApptime);
          if(detObj.data==null || detJson.scienStepcode>1){
            $('#scienStepcode').val(detJson.scienStepcode);
            document.getElementById("scienSave").style.display='none';
            document.getElementById("actions").style.display='none';
          }
          layui.form.render();
        }
      }
    });

    table.render({
      elem: '#test-table-scen-memb'
      ,id: 'membReload'
      ,method: 'post'
      ,url: '/scien/memblist?' + scienId
      ,toolbar: '#test-table-toolbar-toolbarDemo'
      ,title: '科研项目成员表'
      ,page: false
      ,cols: [[
        {type: 'checkbox', fixed: 'left', width:'40'}
        ,{field: 'membId', title: '序号', width:'70'}
        ,{field: 'membName', title: '姓名', edit: 'text', width:'130'}
        ,{field: 'membSex', title: '性別', edit: 'text', width:'130'}
        ,{field: 'membBirth', title: '出生日期', edit: 'text', width:'130'}
        ,{field: 'membIdcard', title: '证件号码', edit: 'text', width:'189'}
        ,{field: 'membAppla', title: '职称', edit: 'text', width:'130'}
        ,{field: 'membDuty', title: '职务', edit: 'text', width:'130'}
        ,{field: 'membDegree', title: '学位', edit: 'text', width:'130'}
        ,{field: 'membProf', title: '专业', edit: 'text', width:'130'}
        ,{field: 'membRole', title: '在项目中的角色', edit: 'text', width:'150'}
        ,{field: 'membUnit', title: '工作单位', edit: 'text', width:'128'}
      ]]
    });

    //头工具栏事件
    table.on('toolbar(test-table-scen-memb)', function(obj){
      var checkStatus = table.checkStatus(obj.config.id);
      switch(obj.event){
        case 'add':
          postdata('add&'+document.getElementById("scienId").value+'&0',"/scien/membupdate"
                  ,function () {table.reload('membReload');layer.msg("添加成功！");});
          break;
        case 'del':
          postdata('del&'+document.getElementById("scienId").value+'&'+checkStatus.data[0].membId,"/scien/membupdate"
                  ,function () {table.reload('membReload');layer.msg("已删除！");});
          break;
      };
    });

    //监听单元格编辑
    table.on('edit(test-table-scen-memb)', function(obj){
      if($('#scienStepcode').val()==1){
        var params=obj.data.membId+'&'+obj.field+'&'+obj.value;
        postdata(params,"/scien/membupdate",function () {
          table.reload('membReload');layer.msg("更新成功");})
      }else{
        layer.msg("请退回项目申报后再修改");
      }
    });

    /* 自定义验证规则 */
    form.verify({
      scienNo: function(value){
        if(value.length < 10){
          return '标题至少得10个字符啊';
        }
      }
    });

  });

  function save(){
    var params={};
    params.scienId=$('#scienId').val();
    params.scienType=$('#scienType').val();
    params.scienNo=$('#scienNo').val();
    params.scienYear=$('#scienYear').val();
    params.scienName=$('#scienName').val();
    params.scienMajor=$('#scienMajor').val();
    params.unitName=$('#unitName').val();
    params.unitCode=$('#unitCode').val();
    params.unitContman=$('#unitContman').val();
    params.unitConttel=$('#unitConttel').val();
    params.unitAddr=$('#unitAddr').val();
    params.unitPost=$('#unitPost').val();
    params.unitNature=$("input[name='unitNature']:checked").val();
    params.unitCoop=$('#unitCoop').val();
    params.scienAppman=$('#scienAppman').val();
    params.scienAppsex=$("input[name='scienAppsex']:checked").val();
    params.scienAppdegree=$("input[name='scienAppdegree']:checked").val();
    params.scienAppbirth=$('#scienAppbirth').val();
    params.scienAppprof=$("input[name='scienAppprof']:checked").val();
    params.scienAppmajor=$('#scienAppmajor').val();
    params.scienApptel=$('#scienApptel').val();
    params.scienAppphone=$('#scienAppphone').val();
    params.scienAppemail=$('#scienAppemail').val();
    params.scienAppteam=$('#scienAppteam').val();
    params.scienApplife=$('#scienApplife').val();
    params.scienInnov= $("input[name=scienInnov]:checked").map(function() {
      return $(this).val();
    }).get().join(",");
    params.scienNote=$('#scienNote').val();
    params.scienAchiev=$('#scienAchiev').val();
    params.scienCost=$('#scienCost').val();
    postdata(params,"/scien/sciensave",function () {layer.msg("保存成功！");});
  }
  function downloadPDF(){
    layer.msg("downloadPDF");
  }
</script>
</body>
</html>